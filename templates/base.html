{% load static tailwind_tags %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      {% block title %}
        Dr.Ketul Soni Homeopathic Clinic
      {% endblock %}
    </title>

    {% tailwind_css %}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />
    <style>
      /* Disabled dates – clearly grey */
      .flatpickr-day.disabled,
      .flatpickr-day.disabled:hover {
        background-color: #f3f4f6 !important; /* light gray */
        color: #9ca3af !important; /* gray text */
        cursor: not-allowed !important;
        text-decoration: line-through;
      }
      
      /* Today highlight */
      .flatpickr-day.today {
        border-color: #2563eb !important;
      }
    </style>
  </head>

  <body class="bg-background text-foreground">
    {% include 'components/navbar.html' %}

    {% block content %}
      <link rel="manifest" href="{% static 'manifest.json' %}" />
      <meta name="theme-color" content="#2563eb" />
    {% endblock %}
    <input type="hidden" id="csrf-token" value="{{ csrf_token }}" />

    {% include 'components/footer.html' %}

    <!-- <script src="{% static 'js/ui.js' %}"></script> -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-messaging-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <script>
      // security
      function getCSRFToken() {
        const name = 'csrftoken'
        const cookies = document.cookie.split(';')
      
        for (let cookie of cookies) {
          cookie = cookie.trim()
          if (cookie.startsWith(name + '=')) {
            return cookie.substring(name.length + 1)
          }
        }
        return null
      }
      
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker
          .register('/firebase-messaging-sw.js')
          .then((reg) => {
            console.log()
          })
          .catch((err) => {
            console.error('❌ SW registration failed', err)
          })
      }
      
      async function requestNotificationPermission() {
        const permission = await Notification.requestPermission()
        if (permission === 'granted') {
          console.log('Notification permission granted')
        } else {
          console.log('Notification permission denied')
        }
      }
      
      async function registerFakeDevice() {
        const fakeToken = crypto.randomUUID()
      
        try {
          const res = await fetch('/register-device/', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: new URLSearchParams({
              token: fakeToken,
              user_type: 'doctor',
              user_id: '{{ request.user.id|default:1 }}'
            })
          })
      
          if (res.ok) {
            console.log('✅ Device registered:', fakeToken)
            alert('Device registered for notifications')
          } else {
            console.error('❌ Device registration failed')
          }
        } catch (err) {
          console.error('❌ Error registering device', err)
        }
      }
      
      const hamburger = document.getElementById('hamburger')
      const navLinks = document.getElementById('navLinks')
      
      hamburger.addEventListener('click', () => {
        navLinks.classList.toggle('show')
      })
    </script>
    <!-- Flatpickr JS -->
  </body>
</html>
